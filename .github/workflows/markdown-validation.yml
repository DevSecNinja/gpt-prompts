name: Markdown Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  markdown-lint:
    name: Lint Markdown Files
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Lint markdown files
        uses: articulate/actions-markdownlint@v1
        with:
          config: .markdownlint.json
          files: '**/*.md'
          ignore: node_modules
          version: '0.32.2'

  markdown-link-check:
    name: Check Markdown Links
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check links in markdown files
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          use-verbose-mode: 'no'
          config-file: '.markdown-link-check.json'

  validate-structure:
    name: Validate Prompt Structure
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check prompt files have required sections
        run: |
          EXIT_CODE=0
          
          for file in prompts/**/*.md; do
            if [ -f "$file" ]; then
              echo "Checking $file..."
              
              # Check for required headers
              if ! grep -q "^# " "$file"; then
                echo "❌ Missing title in $file"
                EXIT_CODE=1
              fi
              
              if ! grep -q "^## Category" "$file"; then
                echo "❌ Missing Category section in $file"
                EXIT_CODE=1
              fi
              
              if ! grep -q "^## Description" "$file"; then
                echo "❌ Missing Description section in $file"
                EXIT_CODE=1
              fi
              
              if ! grep -q "^## Prompt" "$file"; then
                echo "❌ Missing Prompt section in $file"
                EXIT_CODE=1
              fi
              
              if [ $EXIT_CODE -eq 0 ]; then
                echo "✅ $file is valid"
              fi
            fi
          done
          
          exit $EXIT_CODE
